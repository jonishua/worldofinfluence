# PHASE 1: Geolocation & Supply Drops (The Core Loop)

**Document Type:** Technical Feature Specification
**Project:** World of Influence (Fintech Strategy Game MVP)
**Goal:** Transform the static map into a location-aware gameplay board. Implement real-time user tracking, the "Property Grid," and the "Supply Drop" collection loop.

## 1. Context & Design Philosophy
* **The Vibe:** "The Bank Vault." This is not a playful game; it is a financial scanning tool. The UI must be slick, responsive, and precise.
* **Trust Signal:** Accuracy. The GPS puck must move smoothly, not jump.
* **Core Loop:** Move Physical Body -> Enter 50m Radius -> Collect Asset -> "Earning" Animation.

## 2. Technical Stack & Dependencies
* **Framework:** Next.js 14 (App Router)
* **Map Engine:** `react-leaflet` (Leaflet CSS)
* **State Management:** `zustand` (User location, Wallet Balance, Inventory)
* **Math/Geo:** `@turf/turf` (REQUIRED: Standard for geospatial calculations like distance and random point generation)
* **Icons:** `lucide-react`
* **Styling:** Tailwind CSS

## 3. Strict Design Rules (From "Fintech Trust Signals" Doc)
1.  **Colors:**
    * **Growth Green:** `#00C805` (Used for positive action/money).
    * **Slate:** `#1F2937` (Primary text/ui).
    * **Grid:** Faint Grey (e.g., `#E5E7EB`) to mimic architectural blueprints.
2.  **Typography:**
    * **Currency:** MUST use a **Monospaced Font** (e.g., `Roboto Mono`) so numbers align perfectly.
3.  **Juice (Micro-interactions):**
    * **The Odometer:** Money never just "appears." It must count up/roll up like a gas pump display.

## 4. Feature Implementation Specs

### Feature A: The "Player Puck" (Real-Time GPS)
Replace the static center marker with a dynamic, GPS-driven avatar.

* **Logic:**
    * Use `navigator.geolocation.watchPosition` to track real-world movement.
    * Update the Zustand store with `[latitude, longitude]`.
    * **Smooth Lerp:** The marker should not "jump" instantly between updates. Use CSS transitions or `react-spring` to interpolate position updates for a smooth "Uber-like" glide.
* **Visuals:**
    * **Avatar:** A "Navigation Arrow" icon (clean, sharp) pointing in the direction of heading (if available) or static up.
    * **The Radius Ring:** Draw a semi-transparent circle around the user representing the **50m Interaction Zone**.
        * **Style:** Border `1px solid #00C805`, Fill `#00C805` at 10% opacity.
        * **Pulse:** Add a subtle CSS "Radar" pulse animation every 3 seconds.

### Feature B: The Grid Overlay (The 10m Property Lines)
Render the 10m x 10m grid on the map to show where land parcels exist.

* **Logic:**
    * Use a lightweight Grid Layer (Canvas or SVG pattern) overlay on Leaflet.
    * **Optimization:** Only render the grid when Zoom Level > 16. Fade it out when zoomed out to reduce visual noise.
* **Style:** The lines should be faint grey. It should look like a professional survey map, not a chessboard.

### Feature C: Supply Drops ("The Find")
Procedurally spawn "Assets" around the user to simulate gameplay.

* **Spawning Algorithm (Client-Side Mock):**
    * On app load, generate 10-15 random "Drop Points" within a **500m radius** (View Radius) of the user's initial location.
    * Use `turf.randomPoint` bounded by the user's bounding box.
* **Visual Representation:**
    * **Icon:** Use the `Briefcase` or `Package` icon from Lucide.
    * **Color:** Dark Slate (`#1F2937`) with a small Green badge/dot.
    * **States:**
        * **Locked (Out of Range > 50m):** Opacity 60%, Small Scale.
        * **Actionable (In Range < 50m):** Opacity 100%, Normal Scale, bouncing slightly ("Pick me up").

### Feature D: Collection Mechanics ("The Transaction")
The user taps a drop to collect it.

* **Interaction Flow:**
    1.  **Tap:** User clicks a Supply Drop marker.
    2.  **Check:** Calculate distance between `User Location` and `Drop Location` using `turf.distance`.
    3.  **Fail State (>50m):** Show a professional "Toast" notification: *"Target out of range. Move closer to secure asset."*
    4.  **Success State (<50m):**
        * **Animation:** The briefcase "opens" or flies up into the HUD wallet.
        * **Reward:** Add a random amount ($0.01 - $0.05) to the global balance.
        * **Removal:** Remove the drop from the map instance.
        * **Feedback:** Trigger a "Success" haptic (if mobile) or a visual flash.

## 5. Step-by-Step Instructions for Cursor

1.  **Dependencies:** Verify `@turf/turf` is installed. If not, tell me to run `npm install @turf/turf`.
2.  **Store Setup (`src/store/useGameStore.ts`):**
    * Create a store to hold `userLocation`, `drops` (array of objects), and `walletBalance`.
    * Add actions: `setUserLocation`, `generateDrops`, `collectDrop`.
3.  **Map Logic (`src/components/map/GameMap.tsx`):**
    * Implement `LocationMarker` to render the user and the 50m radius circle.
    * Implement `SupplyDropLayer` to render the drops.
    * Ensure the map centers on the user initially but allows panning.
4.  **HUD Logic (`src/components/hud/BalanceTicker.tsx`):**
    * Connect the component to `useGameStore`.
    * Ensure the balance formats as currency (e.g., `$12.50`) and uses the monospaced font.
    * Animate the number when it increases.

**Execute this plan now.**