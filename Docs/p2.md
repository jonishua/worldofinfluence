# PHASE 2: Land Acquisition & The "Minting" Flow

**Document Type:** Technical Feature Specification
**Project:** World of Influence (Fintech Strategy Game MVP)
**Goal:** Implement the "Buy Land" core loop using a high-fidelity **Bottom Sheet UI** and a "Security Theater" animation sequence.

## 1. Context & Design Reference
* **Visual Reference:** We are replicating the "Slide-Up Sheet" behavior from the prototype.
* **The Interaction:** 1. Click Map Parcel -> **Sheet Slides Up** (Preview).
    2. Click "Buy" -> **Sheet Transforms** (Minting Animation).
    3. Success -> **Sheet Expands** (Rarity Reveal).
* **Tech Stack:** * **Framer Motion:** MUST be used for the sheet animations (`AnimatePresence`, `motion.div`). We want smooth physics (springs), not linear CSS transitions.
    * **Tailwind CSS:** For styling (Rounded corners, glassmorphism).

## 2. Feature Implementation Specs

### Feature A: The Grid Logic (Leaflet Layer)
We need to turn the map coordinates into interactive "Parcels."

* **Logic:**
    * Create a `GridLayer.tsx` component.
    * Render 10m x 10m rectangles around the user.
    * **Click Handler:** Clicking a rectangle updates `store.selectedParcel` with `{ lat, lng, id }`.
* **Visuals:**
    * **Unowned:** Faint Grey lines (`border-slate-300`, `bg-slate-500/10`).
    * **Owned:** Solid "Growth Green" (`#00C805`) with a white border.
    * **Selection:** When clicked, the grid square should have a **Dashed White Pulse** animation to confirm selection.

### Feature B: The "Bottom Sheet" UI (The Smart Modal)
Replace standard browser alerts with a "Drawer" that slides up from the bottom of the screen.

* **Component Structure:**
    * Create `BottomSheet.tsx`. It should be fixed to the bottom (`bottom-0 left-0 right-0`).
    * **Animation:** `initial={{ y: "100%" }}` -> `animate={{ y: 0 }}`.
* **State 1: "Preview" (The Sales Pitch)**
    * **Header:** Large "ðŸ“" Icon.
    * **Title:** "Acquire Parcel?"
    * **Subtitle:** Display precise coordinates (Monospace font: `30.2672, -97.7431`).
    * **Price:** **100 INK Cash** (Bold).
    * **Actions:**
        * Primary Button: "Confirm Purchase" (Slate Dark).
        * Secondary Button: "Cancel" (Ghost).

### Feature C: The Minting Sequence ("Security Theater")
When "Confirm Purchase" is clicked, do not close the sheet. **Transform** the content inside it.

* **Transition:** The Sheet content fades out, and the "Loader" fades in.
* **The Sequence (3.5 Seconds Total):**
    1.  **0s - 1s:** Show **Spinner**. Text: *"Verifying Coordinates..."*
    2.  **1s - 2.5s:** Text changes to: *"Securing Deed on Chain..."*
    3.  **2.5s:** **Trigger Success.**
* **Technical Note:** Use `setTimeout` in a `useEffect` within the component to manage these stages.

### Feature D: Rarity Reveal (The Reward)
The final stage of the sheet displays the result of the RNG (Random Number Generator).

* **Rarity Logic (Weighted):**
    * **Common (50%):** Standard Rent. Color: `#10b981`. Icon: ðŸŒ±
    * **Rare (30%):** 1.5x Rent. Color: `#3B82F6`. Icon: ðŸŒ³
    * **Epic (15%):** 2.0x Rent. Color: `#8b5cf6`. Icon: â›²
    * **Legendary (5%):** 4.0x Rent. Color: `#f59e0b`. Icon: ðŸ‘‘
* **UI Layout:**
    * **Top Badge:** A pill-shaped tag showing the Rarity Name (e.g., "LEGENDARY").
    * **Center Icon:** Huge Emoji/Icon representing the asset.
    * **Stats:** "Rent Multiplier: 4.0x"
    * **Action:** "Add to Portfolio" button (Closes sheet, updates Map Grid to the new color).

## 3. Step-by-Step Instructions for Cursor

1.  **Install:** Ensure `framer-motion` is installed (`npm install framer-motion`).
2.  **Store (`useGameStore.ts`):**
    * Add `selectedParcel` (object) and `isBottomSheetOpen` (boolean).
    * Add `ownedParcels` array.
3.  **Component 1 (`BottomSheet.tsx`):**
    * Build the container using `motion.div`.
    * Implement a "Step Switcher" inside: `case 'PREVIEW'`, `case 'MINTING'`, `case 'REVEAL'`.
4.  **Component 2 (`GridLayer.tsx`):**
    * Update the grid rendering to check `ownedParcels` and apply the correct Rarity Color (Green, Blue, Purple, Gold).
    * On Click -> `setSelectedParcel` -> `openBottomSheet`.
5.  **Refinement:**
    * Ensure the "Confirm Purchase" button has a **loading state** (disabled) once clicked.
    * Use the "Fintech Slate" (`#1e293b`) for the primary buttons and "Growth Green" for success states.

**Execute this plan.**