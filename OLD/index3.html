<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>World of Influence - Fintech Strategy Game</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- FontAwesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Google Fonts: Roboto Mono for numbers, Inter for UI -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Roboto+Mono:wght@500;700&display=swap" rel="stylesheet">

    <style>
        /* Custom Fonts */
        body { font-family: 'Inter', sans-serif; background-color: #F3F4F6; }
        .font-mono { font-family: 'Roboto Mono', monospace; }

        /* Trust Signals & Palette */
        :root {
            --growth-green: #00C805;
            --neutral-slate: #1F2937;
            --calm-blue: #3B82F6;
            --boost-neon: #39FF14;
        }

        /* Animations */
        @keyframes float {
            0% { transform: translateY(0px); opacity: 1; }
            100% { transform: translateY(-20px); opacity: 0; }
        }
        .float-text {
            position: absolute;
            animation: float 1s ease-out forwards;
            pointer-events: none;
            color: var(--growth-green);
            font-weight: bold;
        }

        /* High Voltage Boost Effect */
        .boost-active {
            box-shadow: 0 0 20px var(--boost-neon), inset 0 0 10px var(--boost-neon);
            border-color: var(--boost-neon) !important;
        }
        .boost-text {
            text-shadow: 0 0 5px var(--boost-neon);
            color: var(--boost-neon) !important;
        }

        /* Slot Machine Reel Blur */
        .reel-blur {
            filter: blur(2px);
            transform: translateY(10px);
        }

        /* Chart Container */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            height: 250px;
        }
        
        /* Custom Scrollbar for Ticker */
        .ticker-wrap {
            width: 100%;
            overflow: hidden;
            background-color: #111;
            color: #39FF14;
            white-space: nowrap;
        }
        .ticker-move {
            display: inline-block;
            animation: ticker 20s linear infinite;
        }
        @keyframes ticker {
            0% { transform: translate3d(100%, 0, 0); }
            100% { transform: translate3d(-100%, 0, 0); }
        }

        /* Map Grid Styles */
        .grid-cell {
            transition: all 0.2s ease;
        }
        .grid-cell:active {
            transform: scale(0.95);
        }
        /* 3D Extrusion Effect for Owned Land */
        .owned-cell {
            box-shadow: 2px 2px 0px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }
    </style>
</head>
<body class="h-screen w-full flex items-center justify-center overflow-hidden text-slate-800">

    <!-- Placeholder Comments -->
    <!-- Chosen Palette: "Growth" Palette (Green #00C805 for income, Slate/White for structure) + Neon Green #39FF14 for Boost events. -->
    <!-- Application Structure Plan: Mobile-app simulation. 
         1. Top Bar: Global "Odometer" balances. 
         2. Main Viewport: Switches between Map (Core Loop), Slots (Mini-Game), Wallet (Fintech Trust), and Passport (Collection). 
         3. Bottom Nav: Persistent access to key views.
         Rationale: Mimics the actual UX of location-based games like Atlas Earth, prioritizing the "Walking -> Buying" loop. -->
    <!-- Visualization & Content Choices: 
         - Map: CSS Grid visualization. Best for interactive performance without heavy WebGL overhead for this prototype. 
         - Wallet: Chart.js Line Chart. Visualizes "Compound Growth" to trigger Acorns-style satisfaction.
         - Slots: CSS/JS Animation. Simulates the "Gamble" aspect of Credits.
         - Confirming NO SVG graphics used (using FontAwesome) and NO Mermaid JS used. -->

    <!-- Mobile App Container -->
    <div id="app-container" class="relative w-full max-w-md h-full max-h-[850px] bg-white sm:rounded-3xl shadow-2xl flex flex-col overflow-hidden border-4 border-slate-200">
        
        <!-- HEADER: Balances & Status -->
        <header class="bg-slate-900 text-white p-4 shadow-md z-20 flex flex-col gap-2">
            <!-- Rent Odometer -->
            <div class="flex justify-between items-end">
                <div>
                    <div class="text-xs text-slate-400 font-semibold tracking-wider uppercase">Portfolio Yield</div>
                    <div id="rent-display" class="font-mono text-3xl text-[#00C805] font-bold tracking-tight">$0.0000000</div>
                </div>
                <div class="text-right">
                    <button id="boost-btn" class="bg-slate-800 hover:bg-slate-700 border border-slate-600 px-3 py-1 rounded-full text-xs font-bold transition-all flex items-center gap-2">
                        <i class="fa-solid fa-bolt text-yellow-400"></i>
                        <span id="boost-status">BOOST OFF</span>
                    </button>
                </div>
            </div>
            
            <!-- Secondary Currencies -->
            <div class="flex gap-4 mt-2">
                <div class="flex items-center gap-1.5 bg-slate-800 px-2 py-1 rounded text-xs">
                    <i class="fa-solid fa-money-bill-wave text-green-400"></i>
                    <span id="ink-balance" class="font-bold">0</span> INK
                </div>
                <div class="flex items-center gap-1.5 bg-slate-800 px-2 py-1 rounded text-xs">
                    <i class="fa-solid fa-gem text-blue-400"></i>
                    <span id="credits-balance" class="font-bold">0</span> Credits
                </div>
                <div class="flex items-center gap-1.5 bg-slate-800 px-2 py-1 rounded text-xs ml-auto">
                    <i class="fa-solid fa-file-contract text-orange-400"></i>
                    <span id="permits-balance" class="font-bold">0</span> Permits
                </div>
            </div>
        </header>

        <!-- MAIN VIEWPORT (Dynamic Content) -->
        <main id="main-view" class="flex-1 relative overflow-y-auto bg-[#F5F7F9]">
            
            <!-- VIEW: MAP (Default) -->
            <div id="view-map" class="w-full h-full flex flex-col relative">
                <!-- Location Header -->
                <div class="absolute top-4 left-1/2 transform -translate-x-1/2 bg-white/90 backdrop-blur-sm px-4 py-2 rounded-full shadow-sm z-10 border border-slate-200">
                    <div class="flex items-center gap-2 text-sm font-semibold text-slate-700">
                        <i class="fa-solid fa-location-dot text-red-500"></i>
                        <span>Austin, Downtown</span>
                    </div>
                </div>

                <!-- The Grid (Simulated 5x5 Map) -->
                <div class="flex-1 flex items-center justify-center bg-gray-100 relative overflow-hidden">
                    <!-- Decor: Roads -->
                    <div class="absolute inset-0 opacity-10 pointer-events-none" style="background-image: linear-gradient(#000 1px, transparent 1px), linear-gradient(90deg, #000 1px, transparent 1px); background-size: 20px 20px;"></div>
                    
                    <div id="map-grid" class="grid grid-cols-5 gap-1 p-4 bg-white shadow-xl rounded-xl border border-slate-200 relative z-0">
                        <!-- JS generates cells here -->
                    </div>

                    <!-- Avatar -->
                    <div class="absolute pointer-events-none z-10 drop-shadow-lg">
                        <i class="fa-solid fa-user-astronaut text-4xl text-slate-800"></i>
                    </div>
                </div>

                <!-- Action Bar -->
                <div class="p-4 bg-white border-t border-slate-200 flex justify-between items-center">
                    <button onclick="app.sim.walk()" class="flex-1 mr-2 bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-xl font-bold shadow-lg active:scale-95 transition">
                        <i class="fa-solid fa-shoe-prints mr-2"></i> Walk (Spawn Drop)
                    </button>
                    <!-- Buy button contextually updates -->
                    <button id="buy-land-btn" onclick="app.game.buyCurrentLocation()" class="flex-1 ml-2 bg-slate-900 text-white py-3 rounded-xl font-bold shadow-lg active:scale-95 transition opacity-50 cursor-not-allowed">
                        <i class="fa-solid fa-sign-hanging mr-2"></i> Buy Plot
                    </button>
                </div>

                <!-- Social Ticker -->
                <div class="ticker-wrap h-8 flex items-center text-xs font-mono">
                    <div class="ticker-move" id="news-ticker">
                        User AustinKing bought 5 plots in Downtown... User CryptoWhale upgraded to Legendary... New Mayor crowned in Dallas...
                    </div>
                </div>
            </div>

            <!-- VIEW: SLOTS -->
            <div id="view-slots" class="hidden w-full h-full flex flex-col bg-slate-900 text-white items-center justify-center p-6">
                <div class="mb-8 text-center">
                    <h2 class="text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-500 neon-text">NEON SLOTS</h2>
                    <p class="text-slate-400 text-sm">Convert Credits to INK Cash</p>
                </div>

                <!-- Slot Machine UI -->
                <div class="bg-black border-4 border-slate-700 p-4 rounded-2xl shadow-2xl w-full max-w-xs relative">
                    <!-- Reels -->
                    <div class="flex gap-2 mb-4 bg-slate-800 p-2 rounded-lg border-inner overflow-hidden h-32 items-center">
                        <div id="reel-1" class="flex-1 h-24 bg-white text-4xl text-black flex items-center justify-center rounded font-bold border-2 border-slate-300">7</div>
                        <div id="reel-2" class="flex-1 h-24 bg-white text-4xl text-black flex items-center justify-center rounded font-bold border-2 border-slate-300">7</div>
                        <div id="reel-3" class="flex-1 h-24 bg-white text-4xl text-black flex items-center justify-center rounded font-bold border-2 border-slate-300">7</div>
                    </div>
                    
                    <!-- Lever/Button -->
                    <button id="spin-btn" onclick="app.game.spinSlots()" class="w-full bg-gradient-to-b from-red-500 to-red-700 hover:from-red-400 hover:to-red-600 text-white font-bold py-4 rounded-xl shadow-lg border-b-4 border-red-900 active:border-b-0 active:translate-y-1 transition text-xl">
                        SPIN (1 Credit)
                    </button>
                </div>

                <!-- Payout Table -->
                <div class="mt-8 bg-slate-800/50 p-4 rounded-xl w-full text-xs font-mono text-slate-300">
                    <div class="flex justify-between border-b border-slate-700 pb-1 mb-1"><span>7-7-7</span> <span class="text-yellow-400">50 INK</span></div>
                    <div class="flex justify-between border-b border-slate-700 pb-1 mb-1"><span><i class="fa-solid fa-gem"></i>-<i class="fa-solid fa-gem"></i>-<i class="fa-solid fa-gem"></i></span> <span class="text-blue-400">15 INK</span></div>
                    <div class="flex justify-between border-b border-slate-700 pb-1 mb-1"><span><i class="fa-solid fa-scroll"></i>-<i class="fa-solid fa-scroll"></i>-<i class="fa-solid fa-scroll"></i></span> <span class="text-purple-400">1 PERMIT</span></div>
                    <div class="flex justify-between"><span><i class="fa-solid fa-lemon"></i> Any</span> <span class="text-green-400">1 INK</span></div>
                </div>
            </div>

            <!-- VIEW: WALLET -->
            <div id="view-wallet" class="hidden w-full h-full flex flex-col bg-[#F5F7F9] p-4 overflow-y-auto">
                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-slate-800">My Portfolio</h2>
                    <p class="text-sm text-slate-500">Bank Grade Security ‚Ä¢ SIPC Insured (Sim)</p>
                </div>

                <!-- Yield Graph -->
                <div class="bg-white p-4 rounded-xl shadow-sm border border-slate-200 mb-4">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-bold text-sm text-slate-700">Projected Yield</h3>
                        <span class="text-xs bg-green-100 text-green-800 px-2 py-0.5 rounded-full font-bold">+12.4%</span>
                    </div>
                    <div class="chart-container">
                        <canvas id="yieldChart"></canvas>
                    </div>
                </div>

                <!-- Cash Out Block -->
                <div class="bg-slate-900 text-white p-6 rounded-xl shadow-lg mb-6 relative overflow-hidden">
                    <div class="relative z-10">
                        <div class="text-slate-400 text-xs font-bold uppercase mb-1">Withdrawable Cash</div>
                        <div class="text-3xl font-mono font-bold mb-4" id="wallet-cash-display">$0.00</div>
                        <div class="flex gap-2">
                            <button class="flex-1 bg-[#00C805] hover:bg-green-500 text-white py-2 rounded-lg font-bold text-sm shadow transition">
                                Cash Out
                            </button>
                            <button class="flex-1 bg-slate-700 hover:bg-slate-600 text-white py-2 rounded-lg font-bold text-sm shadow transition">
                                Re-Invest (20% Bonus)
                            </button>
                        </div>
                    </div>
                    <!-- Decor -->
                    <i class="fa-solid fa-vault absolute -right-4 -bottom-4 text-8xl text-slate-800 opacity-50"></i>
                </div>

                <!-- Transaction History -->
                <h3 class="font-bold text-slate-800 mb-2">Recent Activity</h3>
                <div class="bg-white rounded-xl border border-slate-200 divide-y divide-slate-100">
                    <div class="p-3 flex justify-between items-center">
                        <div class="flex items-center gap-3">
                            <div class="w-8 h-8 rounded-full bg-green-100 flex items-center justify-center text-green-600"><i class="fa-solid fa-arrow-trend-up text-xs"></i></div>
                            <div>
                                <div class="text-sm font-bold text-slate-700">Daily Rent</div>
                                <div class="text-xs text-slate-400">Today, 9:00 AM</div>
                            </div>
                        </div>
                        <div class="text-sm font-bold text-green-600">+$0.45</div>
                    </div>
                    <div class="p-3 flex justify-between items-center">
                        <div class="flex items-center gap-3">
                            <div class="w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center text-slate-600"><i class="fa-solid fa-shop text-xs"></i></div>
                            <div>
                                <div class="text-sm font-bold text-slate-700">Land Purchase</div>
                                <div class="text-xs text-slate-400">Yesterday</div>
                            </div>
                        </div>
                        <div class="text-sm font-bold text-slate-900">-100 INK</div>
                    </div>
                </div>
            </div>
            
            <!-- VIEW: PASSPORT -->
            <div id="view-passport" class="hidden w-full h-full flex flex-col bg-slate-800 text-white p-4">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold font-serif">Passport</h2>
                    <div class="bg-slate-700 px-3 py-1 rounded-full text-xs font-mono">Boost Level: <span class="text-yellow-400">Tier 1 (+5%)</span></div>
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <!-- Key Card -->
                    <div class="bg-slate-700 p-4 rounded-lg border border-slate-600 flex flex-col items-center justify-center aspect-square shadow-lg transform hover:scale-105 transition">
                        <i class="fa-solid fa-key text-4xl text-yellow-500 mb-3 drop-shadow-md"></i>
                        <h3 class="font-bold text-center">Austin, TX</h3>
                        <span class="text-xs text-slate-400 mt-1">Acquired 10/24</span>
                    </div>
                     <!-- Empty Slot -->
                     <div class="bg-slate-700/50 p-4 rounded-lg border border-slate-600 border-dashed flex flex-col items-center justify-center aspect-square opacity-70">
                        <i class="fa-solid fa-lock text-2xl text-slate-500 mb-2"></i>
                        <span class="text-xs text-slate-400">Locked</span>
                    </div>
                </div>
                
                <div class="mt-8 text-center">
                    <button class="bg-yellow-600 hover:bg-yellow-500 text-white px-6 py-3 rounded-xl font-bold shadow-lg w-full flex items-center justify-center gap-2">
                        <i class="fa-solid fa-cart-shopping"></i> Buy Current City Key (200 INK)
                    </button>
                    <p class="text-xs text-slate-400 mt-2">Buying this key pays a royalty to Mayor <span class="text-white font-bold">@AustinKing</span></p>
                </div>
            </div>

        </main>

        <!-- BOTTOM NAV -->
        <nav class="bg-white border-t border-slate-200 px-6 py-3 flex justify-between items-center z-20">
            <button onclick="app.nav.go('map')" class="nav-btn text-blue-600 flex flex-col items-center gap-1 active:scale-90 transition" data-target="map">
                <i class="fa-solid fa-map text-xl"></i>
                <span class="text-[10px] font-bold">Map</span>
            </button>
            <button onclick="app.nav.go('slots')" class="nav-btn text-slate-400 flex flex-col items-center gap-1 active:scale-90 transition hover:text-slate-600" data-target="slots">
                <i class="fa-solid fa-gamepad text-xl"></i>
                <span class="text-[10px] font-bold">Slots</span>
            </button>
            <div class="w-12"></div> <!-- Spacer for Edit FAB -->
            <button onclick="app.nav.go('wallet')" class="nav-btn text-slate-400 flex flex-col items-center gap-1 active:scale-90 transition hover:text-slate-600" data-target="wallet">
                <i class="fa-solid fa-wallet text-xl"></i>
                <span class="text-[10px] font-bold">Wallet</span>
            </button>
            <button onclick="app.nav.go('passport')" class="nav-btn text-slate-400 flex flex-col items-center gap-1 active:scale-90 transition hover:text-slate-600" data-target="passport">
                <i class="fa-solid fa-passport text-xl"></i>
                <span class="text-[10px] font-bold">Keys</span>
            </button>
            
            <!-- Floating Action Button (Edit Mode) -->
            <button onclick="app.sim.toggleEditMode()" class="absolute bottom-6 left-1/2 transform -translate-x-1/2 bg-slate-900 text-white w-14 h-14 rounded-full shadow-2xl flex items-center justify-center border-4 border-white active:scale-90 transition hover:bg-slate-800">
                <i class="fa-solid fa-pen-ruler"></i>
            </button>
        </nav>

        <!-- MODALS -->
        <!-- Minting Animation Modal -->
        <div id="minting-modal" class="hidden absolute inset-0 bg-black/90 z-50 flex flex-col items-center justify-center text-white p-8 text-center">
            <div id="mint-step-1" class="hidden">
                <i class="fa-solid fa-satellite-dish text-6xl text-blue-500 mb-6 animate-pulse"></i>
                <h3 class="text-xl font-bold font-mono">Verifying GPS...</h3>
            </div>
            <div id="mint-step-2" class="hidden">
                <i class="fa-solid fa-file-signature text-6xl text-yellow-500 mb-6 animate-bounce"></i>
                <h3 class="text-xl font-bold font-mono">Securing Deed...</h3>
            </div>
            <div id="mint-step-3" class="hidden">
                <i class="fa-solid fa-check-circle text-6xl text-green-500 mb-6"></i>
                <h3 class="text-xl font-bold mb-2">Asset Registered</h3>
                <div id="mint-result-visual" class="text-4xl mb-4">üè†</div>
                <div id="mint-result-text" class="text-2xl font-bold text-green-400 font-mono mb-2">COMMON</div>
                <p class="text-slate-400 text-sm">Visual: Well-Kept Lawn</p>
                <button onclick="document.getElementById('minting-modal').classList.add('hidden')" class="mt-8 bg-white text-black px-8 py-3 rounded-full font-bold">Close</button>
            </div>
        </div>

    </div>

    <script>
        // --- APP STATE & CONFIG ---
        const app = {
            state: {
                rentBalance: 0.004561, // Starting random small amount
                inkCash: 120,          // Enough for 1 plot
                credits: 5,            // Enough for spins
                permits: 0,
                plotsOwned: [], // {id: 12, tier: 'common', type: 'landscaping'}
                boostActive: false,
                boostTime: 0,
                selectedCell: null
            },
            config: {
                baseRate: 0.0000001111,
                boostMultiplier: 30, // 30x Ad Boost
                tiers: {
                    common: { id: 'common', mult: 1, color: '#10B981', icon: 'üå±', name: 'Landscaping', prob: 0.50 },
                    rare: { id: 'rare', mult: 1.5, color: '#3B82F6', icon: '‚òÄÔ∏è', name: 'Solar Panel', prob: 0.80 },
                    epic: { id: 'epic', mult: 2, color: '#8B5CF6', icon: 'üè°', name: 'Modern House', prob: 0.95 },
                    legendary: { id: 'legendary', mult: 4, color: '#F59E0B', icon: 'üèõÔ∏è', name: 'Monument', prob: 1.00 }
                }
            },
            
            // --- CORE MODULES ---
            
            init: () => {
                app.ui.renderGrid();
                app.ui.updateHeader();
                app.game.startLoop();
                app.ui.initChart();
                
                // Event Listeners
                document.getElementById('boost-btn').addEventListener('click', app.game.toggleBoost);
            },

            // --- NAVIGATION ---
            nav: {
                go: (viewId) => {
                    // Hide all views
                    ['map', 'slots', 'wallet', 'passport'].forEach(v => {
                        document.getElementById(`view-${v}`).classList.add('hidden');
                    });
                    // Show target
                    document.getElementById(`view-${viewId}`).classList.remove('hidden');
                    
                    // Update Nav Icons
                    document.querySelectorAll('.nav-btn').forEach(btn => {
                        if(btn.dataset.target === viewId) {
                            btn.classList.remove('text-slate-400');
                            btn.classList.add('text-blue-600');
                        } else {
                            btn.classList.add('text-slate-400');
                            btn.classList.remove('text-blue-600');
                        }
                    });
                }
            },

            // --- GAME LOGIC ---
            game: {
                startLoop: () => {
                    setInterval(() => {
                        // Calculate Rent
                        let totalMult = 0;
                        // Default to 1 phantom plot if none owned so numbers move
                        let activePlots = app.state.plotsOwned.length > 0 ? app.state.plotsOwned : [{tier: 'common'}];
                        
                        activePlots.forEach(plot => {
                            const tierData = app.config.tiers[plot.tier];
                            totalMult += tierData.mult;
                        });

                        const boost = app.state.boostActive ? app.config.boostMultiplier : 1;
                        const tickAmount = (app.config.baseRate * totalMult * boost); // per second

                        // Update Balance (divided by 10 for 100ms tick smoothness)
                        app.state.rentBalance += (tickAmount / 10);
                        
                        // Decrease Boost Timer
                        if (app.state.boostActive && app.state.boostTime > 0) {
                            app.state.boostTime -= 0.1; 
                            if(app.state.boostTime <= 0) app.game.toggleBoost(); // turn off
                        }

                        app.ui.updateOdometer();

                    }, 100); // 10 ticks per second for smoothness
                },

                toggleBoost: () => {
                    if (!app.state.boostActive) {
                        // Activate
                        app.state.boostActive = true;
                        app.state.boostTime = 3600; // 1 hour simulated
                        document.getElementById('app-container').classList.add('boost-active');
                        document.getElementById('boost-status').innerText = "30x ACTIVE";
                        document.getElementById('boost-status').classList.add('boost-text');
                    } else {
                        // Deactivate
                        app.state.boostActive = false;
                        document.getElementById('app-container').classList.remove('boost-active');
                        document.getElementById('boost-status').innerText = "BOOST OFF";
                        document.getElementById('boost-status').classList.remove('boost-text');
                    }
                },

                buyCurrentLocation: () => {
                    if (app.state.inkCash < 100) {
                        alert("Insufficient INK Cash! Walk to find more or visit the shop.");
                        return;
                    }
                    if (!app.state.selectedCell) return;

                    // Deduct Cost
                    app.state.inkCash -= 100;
                    app.ui.updateHeader();

                    // Start Minting Sequence
                    const modal = document.getElementById('minting-modal');
                    modal.classList.remove('hidden');
                    
                    // Step 1: Verify
                    document.getElementById('mint-step-1').classList.remove('hidden');
                    
                    setTimeout(() => {
                        // Step 2: Secure
                        document.getElementById('mint-step-1').classList.add('hidden');
                        document.getElementById('mint-step-2').classList.remove('hidden');
                    }, 1500);

                    setTimeout(() => {
                        // Step 3: Reveal Logic
                        document.getElementById('mint-step-2').classList.add('hidden');
                        document.getElementById('mint-step-3').classList.remove('hidden');

                        // RNG
                        const rand = Math.random();
                        let result = app.config.tiers.common;
                        if (rand > 0.50) result = app.config.tiers.rare;
                        if (rand > 0.80) result = app.config.tiers.epic;
                        if (rand > 0.95) result = app.config.tiers.legendary;

                        // Update UI Result
                        document.getElementById('mint-result-text').innerText = result.id.toUpperCase();
                        document.getElementById('mint-result-text').style.color = result.color;
                        document.getElementById('mint-result-visual').innerText = result.icon;

                        // Save Data
                        const cellId = app.state.selectedCell;
                        app.state.plotsOwned.push({ id: cellId, tier: result.id, type: result.name });
                        
                        // Update Map
                        app.ui.renderGrid(); // Refresh map to show ownership

                    }, 3500);
                },

                spinSlots: () => {
                    if (app.state.credits < 1) {
                        alert("Need more Credits! Walk around.");
                        return;
                    }

                    // Deduct
                    app.state.credits -= 1;
                    app.ui.updateHeader();

                    // Animate Reels
                    const reels = [document.getElementById('reel-1'), document.getElementById('reel-2'), document.getElementById('reel-3')];
                    reels.forEach(r => r.classList.add('reel-blur'));

                    setTimeout(() => {
                        reels.forEach(r => r.classList.remove('reel-blur'));
                        // Simple RNG for demo
                        const symbols = ['7', 'üíé', 'üçí', 'üìú', 'BAR'];
                        const r1 = symbols[Math.floor(Math.random() * symbols.length)];
                        const r2 = symbols[Math.floor(Math.random() * symbols.length)];
                        const r3 = symbols[Math.floor(Math.random() * symbols.length)];

                        reels[0].innerText = r1;
                        reels[1].innerText = r2;
                        reels[2].innerText = r3;

                        // Check Win
                        if (r1 === '7' && r2 === '7' && r3 === '7') {
                            alert("JACKPOT! +50 INK");
                            app.state.inkCash += 50;
                        } else if (r1 === r2 && r2 === r3) {
                            alert("Triple Match! +15 INK");
                            app.state.inkCash += 15;
                        } else if (r1 === 'üçí' || r2 === 'üçí' || r3 === 'üçí') {
                             // Small win
                             app.state.inkCash += 1;
                        }
                        app.ui.updateHeader();
                    }, 1000);
                }
            },

            // --- SIMULATION (Walking/Drops) ---
            sim: {
                walk: () => {
                    // Randomly spawn a drop on the grid
                    const cells = document.querySelectorAll('.grid-cell:not(.owned)');
                    if (cells.length > 0) {
                        const randomCell = cells[Math.floor(Math.random() * cells.length)];
                        
                        // Visual
                        const drop = document.createElement('div');
                        drop.innerHTML = '<i class="fa-solid fa-box-open text-orange-500 animate-bounce"></i>';
                        drop.className = 'absolute inset-0 flex items-center justify-center text-2xl z-20 pointer-events-none';
                        randomCell.appendChild(drop);
                        randomCell.classList.add('has-drop');
                        
                        // Add Click Handler for collection
                        randomCell.onclick = () => {
                            if (randomCell.classList.contains('has-drop')) {
                                app.sim.collectDrop(randomCell);
                            } else {
                                app.ui.selectCell(randomCell.dataset.id);
                            }
                        };
                    }
                },

                collectDrop: (cellElement) => {
                    // Remove visuals
                    cellElement.innerHTML = ''; // clear icon
                    cellElement.classList.remove('has-drop');
                    
                    // Logic: Give Reward
                    const reward = Math.random() > 0.2 ? 'credits' : 'ink';
                    const amount = reward === 'credits' ? 2 : 5;
                    
                    if (reward === 'credits') app.state.credits += amount;
                    else app.state.inkCash += amount;
                    
                    app.ui.updateHeader();

                    // Floating Text Effect
                    const float = document.createElement('div');
                    float.className = 'float-text';
                    float.style.left = cellElement.offsetLeft + 'px';
                    float.style.top = cellElement.offsetTop + 'px';
                    float.innerText = `+${amount} ${reward.toUpperCase()}`;
                    document.getElementById('map-grid').appendChild(float);
                    
                    setTimeout(() => float.remove(), 1000);
                },

                toggleEditMode: () => {
                    alert("Entering City Planning Mode... (Drag & Drop landmarks to rearrange)");
                }
            },

            // --- UI RENDERING ---
            ui: {
                updateHeader: () => {
                    document.getElementById('ink-balance').innerText = app.state.inkCash;
                    document.getElementById('credits-balance').innerText = app.state.credits;
                    document.getElementById('permits-balance').innerText = app.state.permits;
                    
                    // Enable/Disable Buy Button based on funds
                    const buyBtn = document.getElementById('buy-land-btn');
                    if(app.state.inkCash >= 100 && app.state.selectedCell) {
                        buyBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                        buyBtn.classList.add('animate-pulse');
                    } else {
                        buyBtn.classList.add('opacity-50', 'cursor-not-allowed');
                        buyBtn.classList.remove('animate-pulse');
                    }
                },

                updateOdometer: () => {
                    document.getElementById('rent-display').innerText = '$' + app.state.rentBalance.toFixed(7);
                    document.getElementById('wallet-cash-display').innerText = '$' + app.state.rentBalance.toFixed(2);
                },

                renderGrid: () => {
                    const grid = document.getElementById('map-grid');
                    grid.innerHTML = ''; // clear
                    
                    for (let i = 0; i < 25; i++) {
                        const cell = document.createElement('div');
                        cell.className = 'grid-cell w-full h-16 bg-white border border-slate-100 relative cursor-pointer hover:bg-slate-50 rounded-sm';
                        cell.dataset.id = i;
                        
                        // Check ownership
                        const owned = app.state.plotsOwned.find(p => p.id == i);
                        if (owned) {
                            const tierInfo = app.config.tiers[owned.tier];
                            cell.classList.add('owned-cell');
                            cell.style.backgroundColor = tierInfo.color;
                            cell.style.border = '2px solid #fff';
                            cell.innerHTML = `<span class="text-xl absolute inset-0 flex items-center justify-center">${tierInfo.icon}</span>`;
                        } else {
                            // Empty plot logic
                            cell.onclick = () => app.ui.selectCell(i);
                        }
                        
                        grid.appendChild(cell);
                    }
                },

                selectCell: (id) => {
                    // Visual selection logic
                    document.querySelectorAll('.grid-cell').forEach(c => c.style.borderColor = '#F1F5F9'); // reset
                    const cell = document.querySelector(`.grid-cell[data-id="${id}"]`);
                    if(cell && !app.state.plotsOwned.find(p => p.id == id)) {
                        cell.style.borderColor = '#00C805';
                        cell.style.borderWidth = '2px';
                        app.state.selectedCell = id;
                        app.ui.updateHeader(); // Recheck button state
                    }
                },

                initChart: () => {
                    const ctx = document.getElementById('yieldChart').getContext('2d');
                    new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                            datasets: [{
                                label: 'Earnings ($)',
                                data: [0.12, 0.19, 0.25, 0.35, 0.42, 0.45, 0.51],
                                borderColor: '#00C805',
                                backgroundColor: 'rgba(0, 200, 5, 0.1)',
                                tension: 0.4,
                                fill: true,
                                pointRadius: 0
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: { legend: { display: false } },
                            scales: {
                                x: { grid: { display: false } },
                                y: { beginAtZero: true }
                            }
                        }
                    });
                }
            }
        };

        // Boot
        window.onload = app.init;

    </script>
</body>
</html>